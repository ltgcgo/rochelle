"use strict";let E={"866":"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"};let B={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1};let h=class{static BYTE_1=0;static BYTE_1_VL=1;static BYTE_2_LE=2;static BYTE_2_BE=3;static BYTE_3_LE=4;static BYTE_3_BE=5;static BYTE_4_LE=6;static BYTE_4_BE=7;static getUnitSize(s){if(s>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(s>>1)+1}static isBigEndian(s){return(s&1)===1}static collapse(s){let r=E[s];if(typeof r!="string")throw new TypeError(`Provided label "${s}" is not supported.`);return r}static indicator(s){let r=B[s];if(typeof r!="number")throw new TypeError(`Provided collapsed label "${s}" is not supported.`);return r}};let g=(u,s)=>{u.unsent=!1,u.enqueue(s)},m=(u,s,r=1,b=!0)=>{if(typeof r!="number"||r<=0||r>4)throw new RangeError(`Invalid byte size ${r}.`);if(!(u instanceof Uint8Array||u instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof s!="number"||s<0||s>=u.length)throw new RangeError(`Provided offset ${s} is out of buffer range.`);if(r===1)return u[s];{let f=0;if(b)for(let l=0;l<r;l++)f<<=8,f|=u[s+l];else for(let l=0;l<r;l++)f|=u[s+l]<<(l<<3);return f<0?f+4294967296:f}},U=class{static lineRaw(u,s=0){if(typeof s!="number"||s<0||s>7)throw new TypeError("Invalid split mode.");if(!u||u?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let r=h.getUnitSize(s),b=h.isBigEndian(s),f=u.getReader(),l,i=!1,a=[],t=0,p=0,o=0;return new ReadableStream({pull:async c=>{for(c.unsent=!0;c.unsent;){if(!l||t>=l.length){t>p&&(a.push(l.subarray(p)),p=0);let d=await f.read();l=d.value,i=d.done,t=0}if(l){let d=0;if(r===1)d=l[t];else if(b)for(let n=0;n<r;n++)d<<=8,d|=l[t+n];else for(let n=0;n<r;n++)d|=l[t+n]<<(n<<3);let e=!1;switch(d){case 10:{o===13?p+=r:e=!0;break}case 13:{e=!0;break}}if(e){if(a.length){a.push(l.subarray(p,t));let n=0;for(let y=0;y<a.length;y++)n+=a[y].length;let w=new Uint8Array(n),k=0;for(let y=0;y<a.length;y++)w.set(a[y],k),k+=a[y].length;g(c,w),a=[]}else g(c,l.subarray(p,t));p=t+=r}o=d}if(i){if(p!==t&&l&&a.push(l.subarray(p,t)),a.length){let d=0;for(let w=0;w<a.length;w++)d+=a[w].length;let e=new Uint8Array(d),n=0;for(let w=0;w<a.length;w++)e.set(a[w],n),n+=a[w].length;g(c,e)}c.unsent=!1,c.close()}t+=r}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(u,s="utf-8"){if(!u||u?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let r=h.indicator(s),b=h.getUnitSize(r),f=h.isBigEndian(r),l=u.getReader(),i;return new ReadableStream({pull:async a=>{a.unsent=!0;let{value:t,done:p}=await l.read();if(t){let o=0,c=t.length;if(r!==0&&typeof i?.length=="number"){let d=!1;switch(s){case"big5":case"gbk":case"sjis":case"euc-kr":{o=1;let e=new Uint8Array(2);e[0]=i[0],e[1]=t[0],g(a,e);break}case"euc-jp":{let e=3;i[0]===143?o=3-i.length:i[0]>127?(o=1,e=2):e=i.length;let n=new Uint8Array(3);n.set(i),n.set(t.subarray(0,o),i.length),g(a,n.subarray(0,e));break}case"gb18030":{let e=new Uint8Array(4),n=4;e.set(i),e.set(t.subarray(0,4-i.length),i.length),e[0]<128?n=i.length:e[1]>=64?(o=1,n=2):o=4-i.length,g(a,e.subarray(0,n));break}case"utf-8":{let e=4;i[0]>=240?o=4-i.length:i[0]>=224?(o=3-i.length,e=3):i[0]>=192?(o=1,e=2):e=i.length;let n=new Uint8Array(4);n.set(i),n.set(t.subarray(0,o),i.length),g(a,n.subarray(0,e));break}case"utf-16":case"utf-16be":{let e=new Uint8Array(4);e.set(i),e.set(t.subarray(0,4-i.length)),o=4-i.length,m(transientSize,0,2,f)>=55296&&m(transientSize,2,2,f)>=55296?g(a,e):(g(a,e.subarray(0,2)),g(a,e.subarray(2)));break}default:{let e=new Uint8Array(b);e.set(i),e.set(t.subarray(0,b-i.length),i.length),g(a,e)}}}if(i=void 0,r===0)g(a,t.subarray(o));else{switch(s){case"utf-24":case"utf-24be":{c=Math.floor((t.length-o)/b)*b+o;break}case"utf-32":case"utf-32be":{c=(t.length-o>>2<<2)+o;break}case"utf-8":{if(t[t.length-1]>127){let d=!0,e=t.length,n=t.length-8;for(;d&&e>n;)e--,t[e]<128?c=e+1:t[e]>192&&(c=e)}break}case"utf-16":case"utf-16be":{if(c=(t.length-o>>1<<1)+o,m(t,c-2,2,f)>=55296){let d=!0,e=c,n=c-6;for(;d&&e>n;)e-=2,m(t,e,2,f)>>10===54&&(c=e)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}g(a,t.subarray(o,c))}c<t.length&&(i=t.subarray(c))}p&&(typeof i?.length=="number"&&g(a,i),a.unsent=!1,a.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(u,s="utf-8",r){let b=h.collapse(s),f=h.indicator(b),l=this.lineRaw(u,f).getReader(),i=new TextDecoder(b,r);return new ReadableStream({pull:async a=>{let{value:t,done:p}=await l.read();t&&a.enqueue(i.decode(t)),p&&a.close()}})}static chunk(u,s="utf-8",r){let b=h.collapse(s);if(self.TextDecoderStream){let f=new TextDecoderStream(b,r);return u.pipeTo(f.writable),f.readable}else{let f=this.chunkRaw(u,b).getReader(),l=new TextDecoder(b);return new ReadableStream({pull:async i=>{let{value:a,done:t}=await f.read();a&&(console.debug(a),i.enqueue(l.decode(a))),t&&i.close()}})}}},L=U;export{L as default};
